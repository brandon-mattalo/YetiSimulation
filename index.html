<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ice Melting Comparison: Glass vs Yeti Mug</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bungee:wght@400&family=Fredoka+One:wght@400&family=Righteous:wght@400&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Fredoka One', -apple-system, BlinkMacSystemFont, sans-serif;
            overflow: hidden;
            background: linear-gradient(45deg, #ff6b6b 0%, #4ecdc4 25%, #45b7d1 50%, #96ceb4 75%, #ffeaa7 100%);
            background-size: 400% 400%;
            animation: bowlingAlleyGradient 8s ease infinite;
            color: #fff;
        }
        
        @keyframes bowlingAlleyGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        #container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        
        .header {
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 100;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            padding: 12px 25px;
            border-radius: 20px;
            border: 4px solid #fff;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        
        .header h1 {
            font-family: 'Bungee', cursive;
            font-size: 28px;
            margin-bottom: 5px;
            text-shadow: 3px 3px 0px #000, -1px -1px 0px #000, 1px -1px 0px #000, -1px 1px 0px #000;
            color: #fff;
            letter-spacing: 2px;
        }
        
        .header p {
            font-family: 'Righteous', cursive;
            font-size: 14px;
            margin: 0;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.5);
            color: #fff;
        }
        
        .label {
            position: absolute;
            top: 95px;
            font-family: 'Righteous', cursive;
            font-size: 22px;
            text-align: center;
            width: 48%;
            z-index: 100;
            text-shadow: 3px 3px 0px #000, -2px -2px 0px #000, 2px -2px 0px #000, -2px 2px 0px #000;
            color: #fff;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            padding: 8px 12px;
            border-radius: 15px;
            border: 3px solid #fff;
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
        }
        
        #glass-label {
            left: 1%;
        }
        
        #yeti-label {
            right: 1%;
        }
        
        .temperature-display {
            position: absolute;
            bottom: 140px;
            width: 200px;
            background: linear-gradient(45deg, #4ecdc4, #45b7d1);
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            z-index: 100;
            border: 4px solid #fff;
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
        }
        
        #glass-temp {
            left: calc(25% - 100px);
        }
        
        #yeti-temp {
            right: calc(25% - 100px);
        }
        
        .temp-value {
            font-family: 'Bungee', cursive;
            font-size: 42px;
            margin-bottom: 8px;
            text-shadow: 3px 3px 0px #000, -1px -1px 0px #000, 1px -1px 0px #000, -1px 1px 0px #000;
            color: #fff;
        }
        
        .temp-label {
            font-family: 'Righteous', cursive;
            font-size: 16px;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.5);
            color: #fff;
        }
        
        #controls {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            padding: 25px 35px;
            border-radius: 25px;
            box-shadow: 0 12px 40px rgba(0,0,0,0.3);
            z-index: 100;
            border: 5px solid #fff;
            min-width: 450px;
        }
        
        .controls-row {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        button {
            padding: 12px 24px;
            cursor: pointer;
            background: linear-gradient(45deg, #ffeaa7, #fdcb6e);
            color: #2d3436;
            border: 3px solid #fff;
            border-radius: 15px;
            font-family: 'Righteous', cursive;
            font-size: 16px;
            transition: all 0.3s ease;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        button:hover {
            background: linear-gradient(45deg, #fdcb6e, #e17055);
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        #time-display {
            font-family: 'Bungee', cursive;
            font-size: 18px;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.3);
            color: #fff;
        }
        
        .slider-container {
            width: 100%;
        }
        
        .slider-label {
            font-family: 'Righteous', cursive;
            font-size: 16px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.3);
            color: #fff;
        }
        
        #time-slider {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(45deg, #6c5ce7, #a29bfe);
            border-radius: 4px;
            outline: none;
            border: 2px solid #fff;
        }
        
        #time-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: linear-gradient(45deg, #ffeaa7, #fdcb6e);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
            border: 3px solid #fff;
        }
        
        #time-slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: linear-gradient(45deg, #ffeaa7, #fdcb6e);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
            border: 3px solid #fff;
        }
        
        canvas {
            position: absolute;
            top: 0;
            left: 0;
        }

        /* Small Desktop Responsiveness */
        @media (max-width: 1200px) {
            .header h1 {
                font-size: 24px;
            }
            
            .header p {
                font-size: 13px;
            }
            
            .label {
                font-size: 20px;
                padding: 10px 18px;
            }
            
            .temperature-display {
                width: 180px;
                padding: 18px;
            }
            
            .temp-value {
                font-size: 38px;
            }
            
            #controls {
                min-width: 400px;
                padding: 20px 30px;
            }
            
            button {
                padding: 10px 20px;
                font-size: 15px;
            }
        }

        @media (max-width: 1024px) {
            .header {
                padding: 10px 20px;
            }
            
            .header h1 {
                font-size: 22px;
                letter-spacing: 1.5px;
            }
            
            .header p {
                font-size: 12px;
            }
            
            .label {
                font-size: 18px;
                padding: 8px 15px;
                width: 46%;
            }
            
            .temperature-display {
                bottom: 150px;
                width: 170px;
                padding: 16px;
            }
            
            .temp-value {
                font-size: 35px;
            }
            
            .temp-label {
                font-size: 14px;
            }
            
            #controls {
                min-width: 380px;
                padding: 18px 25px;
            }
            
            button {
                padding: 9px 18px;
                font-size: 14px;
            }
            
            #time-display {
                font-size: 16px;
            }
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .header {
                top: 5px;
                padding: 6px 12px;
                max-width: 95%;
                border-radius: 15px;
                border: 3px solid #fff;
            }
            
            .header h1 {
                font-size: 16px;
                letter-spacing: 0.5px;
                margin-bottom: 2px;
            }
            
            .header p {
                font-size: 10px;
            }
            
            .label {
                top: 50px;
                font-size: 14px;
                width: 35%;
                padding: 4px 6px;
                border-radius: 10px;
                border: 2px solid #fff;
            }
            
            #glass-label {
                left: 2%;
            }
            
            #yeti-label {
                right: 2%;
            }
            
            .temperature-display {
                bottom: 220px;
                width: 120px;
                padding: 10px;
                border-radius: 12px;
                border: 2px solid #fff;
                z-index: 100;
            }
            
            #glass-temp {
                left: 20px;
            }
            
            #yeti-temp {
                right: 20px;
            }
            
            .temp-value {
                font-size: 22px;
                margin-bottom: 3px;
            }
            
            .temp-label {
                font-size: 10px;
            }
            
            #controls {
                bottom: 10px;
                padding: 10px 15px;
                border-radius: 15px;
                border: 2px solid #fff;
                min-width: auto;
                max-width: 95%;
                left: 50%;
                transform: translateX(-50%);
                z-index: 100;
            }
            
            .controls-row {
                flex-wrap: wrap;
                gap: 8px;
                margin-bottom: 8px;
                justify-content: center;
            }
            
            button {
                padding: 6px 12px;
                font-size: 12px;
                border-radius: 10px;
                border: 2px solid #fff;
            }
            
            #time-display {
                font-size: 12px;
                min-width: 100%;
                text-align: center;
                margin-top: 3px;
            }
            
            .slider-label {
                font-size: 12px;
                margin-bottom: 5px;
            }
            
            #time-slider {
                height: 5px;
                border: 2px solid #fff;
            }
            
            #time-slider::-webkit-slider-thumb {
                width: 18px;
                height: 18px;
                border: 2px solid #fff;
            }
            
            #time-slider::-moz-range-thumb {
                width: 18px;
                height: 18px;
                border: 2px solid #fff;
            }
        }

        @media (max-width: 480px) {
            .header {
                top: 3px;
                padding: 4px 8px;
                max-width: 98%;
            }
            
            .header h1 {
                font-size: 14px;
                letter-spacing: 0.5px;
                margin-bottom: 1px;
            }
            
            .header p {
                font-size: 9px;
            }
            
            .label {
                top: 40px;
                font-size: 12px;
                width: 32%;
                padding: 3px 5px;
            }
            
            #glass-label {
                left: 1%;
            }
            
            #yeti-label {
                right: 1%;
            }
            
            .temperature-display {
                bottom: 190px;
                width: 100px;
                padding: 8px;
                z-index: 100;
            }
            
            #glass-temp {
                left: 15px;
            }
            
            #yeti-temp {
                right: 15px;
            }
            
            .temp-value {
                font-size: 18px;
                margin-bottom: 2px;
            }
            
            .temp-label {
                font-size: 9px;
            }
            
            #controls {
                bottom: 5px;
                padding: 8px 10px;
                max-width: 98%;
                left: 50%;
                transform: translateX(-50%);
                z-index: 100;
            }
            
            button {
                padding: 5px 10px;
                font-size: 11px;
            }
            
            #time-display {
                font-size: 11px;
                margin-top: 2px;
            }
            
            .slider-label {
                font-size: 11px;
                margin-bottom: 3px;
            }
            
            #time-slider {
                height: 4px;
            }
            
            #time-slider::-webkit-slider-thumb {
                width: 16px;
                height: 16px;
            }
            
            #time-slider::-moz-range-thumb {
                width: 16px;
                height: 16px;
            }
        }
    </style>
</head>
<body>
    <div id="container">
        <div class="header">
            <h1>üé≥ ICE BOWL CHALLENGE üé≥</h1>
            <p>STRIKE OUT THE HEAT ‚Ä¢ SPARE YOUR DRINKS</p>
        </div>
        
        <div class="label" id="glass-label">ü•§ REGULAR GLASS</div>
        <div class="label" id="yeti-label">üèÜ YETI CHAMPION</div>
        
        <div class="temperature-display" id="glass-temp">
            <div class="temp-value">72¬∞F</div>
            <div class="temp-label">üå°Ô∏è DRINK TEMP</div>
        </div>
        
        <div class="temperature-display" id="yeti-temp">
            <div class="temp-value">72¬∞F</div>
            <div class="temp-label">üå°Ô∏è DRINK TEMP</div>
        </div>
        
        <div id="controls">
            <div class="controls-row">
                <button id="play-pause">üé≥ ROLL</button>
                <button id="reset">üîÑ RESET</button>
                <button id="temp-toggle">üå°Ô∏è ¬∞F</button>
                <span id="time-display">‚è±Ô∏è Time: 0 min</span>
            </div>
            <div class="slider-container">
                <div class="slider-label">üï∞Ô∏è TIME MACHINE</div>
                <input type="range" id="time-slider" min="0" max="1500" value="0" step="1">
            </div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
// Global variables
let scene, camera, renderer;
let glassGroup, yetiGroup;
let glassIceCubes = [], yetiIceCubes = [];
let isPlaying = false;
let simulationTime = 0;
let animationId;
let useCelsius = false;

// Scientifically accurate melt rates based on real-world data
const GLASS_MELT_RATE = 0.008;  // Ice melts completely in ~125 minutes (2 hours)
const YETI_MELT_RATE = 0.0007;  // Ice lasts ~1400+ minutes (24+ hours)
const INITIAL_TEMP = 72; // Room temperature in Fahrenheit
const ICE_TEMP = 32; // Ice temperature

// Temperature conversion functions
function fahrenheitToCelsius(f) {
    return Math.round((f - 32) * 5/9);
}

function formatTemperature(tempF) {
    if (useCelsius) {
        return fahrenheitToCelsius(tempF) + '¬∞C';
    }
    return Math.round(tempF) + '¬∞F';
}

function init() {
    // Scene setup
    scene = new THREE.Scene();
    scene.fog = new THREE.Fog(0x764ba2, 50, 100);

    // Camera setup
    camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(0, 12, 25);
    camera.lookAt(0, 0, 0);

    // Renderer setup
    renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    renderer.setClearColor(0x000000, 0);
    document.getElementById('container').appendChild(renderer.domElement);

    setupLights();
    createContainers();
    createWater();
    createIceCubes();
    setupEventListeners();
    animate();
}

function setupLights() {
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
    scene.add(ambientLight);

    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
    directionalLight.position.set(10, 20, 10);
    directionalLight.castShadow = true;
    directionalLight.shadow.mapSize.width = 2048;
    directionalLight.shadow.mapSize.height = 2048;
    scene.add(directionalLight);

    const rimLight = new THREE.DirectionalLight(0x4a90e2, 0.3);
    rimLight.position.set(-10, 10, -10);
    scene.add(rimLight);
}

function createContainers() {
    // Glass container
    glassGroup = new THREE.Group();
    glassGroup.position.x = -10;
    scene.add(glassGroup);

    // Glass walls
    const glassGeometry = new THREE.CylinderGeometry(3.5, 3, 9, 32, 1, true);
    const glassMaterial = new THREE.MeshPhongMaterial({
        color: 0xffffff,
        opacity: 0.1,
        transparent: true,
        side: THREE.DoubleSide,
        shininess: 100,
        specular: 0xffffff,
        depthWrite: false
    });
    const glass = new THREE.Mesh(glassGeometry, glassMaterial);
    glass.castShadow = true;
    glass.receiveShadow = true;
    glassGroup.add(glass);

    // Glass bottom
    const glassBottomGeometry = new THREE.CircleGeometry(3, 32);
    const glassBottom = new THREE.Mesh(glassBottomGeometry, glassMaterial);
    glassBottom.rotation.x = -Math.PI / 2;
    glassBottom.position.y = -4.5;
    glassGroup.add(glassBottom);

    // Yeti container with cutaway
    yetiGroup = new THREE.Group();
    yetiGroup.position.x = 10;
    scene.add(yetiGroup);

    // Yeti tumbler - same structure as glass but with metallic appearance
    const yetiGeometry = new THREE.CylinderGeometry(3.5, 3, 9, 32, 1, true);
    const yetiMaterial = new THREE.MeshPhongMaterial({
        color: 0x34495e,
        opacity: 0.2,
        transparent: true,
        side: THREE.DoubleSide,
        shininess: 80,
        specular: 0x2c3e50,
        depthWrite: false
    });
    const yeti = new THREE.Mesh(yetiGeometry, yetiMaterial);
    yeti.castShadow = true;
    yeti.receiveShadow = true;
    yetiGroup.add(yeti);

    // Yeti bottom
    const yetiBottomGeometry = new THREE.CircleGeometry(3, 32);
    const yetiBottomMaterial = new THREE.MeshPhongMaterial({
        color: 0x34495e,
        opacity: 0.3,
        transparent: true,
        shininess: 80,
        specular: 0x2c3e50
    });
    const yetiBottom = new THREE.Mesh(yetiBottomGeometry, yetiBottomMaterial);
    yetiBottom.rotation.x = -Math.PI / 2;
    yetiBottom.position.y = -4.5;
    yetiGroup.add(yetiBottom);
}

function createWater() {
    const waterMaterial = new THREE.MeshPhongMaterial({
        color: 0x87ceeb,
        opacity: 0.3,
        transparent: true,
        shininess: 100,
        specular: 0xffffff,
        depthWrite: false
    });

    // Glass water
    const glassWaterGeometry = new THREE.CylinderGeometry(2.8, 2.4, 5, 32);
    const glassWater = new THREE.Mesh(glassWaterGeometry, waterMaterial);
    glassWater.position.y = -2;
    glassGroup.add(glassWater);

    // Yeti water - same size as glass water
    const yetiWaterGeometry = new THREE.CylinderGeometry(2.8, 2.4, 5, 32);
    const yetiWater = new THREE.Mesh(yetiWaterGeometry, waterMaterial);
    yetiWater.position.y = -2;
    yetiGroup.add(yetiWater);
}

function createIceCubes() {
    const iceMaterial = new THREE.MeshPhongMaterial({
        color: 0xe8f4f8,
        opacity: 0.8,
        transparent: true,
        shininess: 100,
        specular: 0xffffff
    });

    // Create 2 ice cubes for each container
    for (let i = 0; i < 2; i++) {
        const size = 1.2 + Math.random() * 0.3;
        const iceGeometry = new THREE.BoxGeometry(size, size, size);
        
        // Glass ice
        const glassIce = new THREE.Mesh(iceGeometry, iceMaterial);
        glassIce.position.set(
            (i === 0 ? -1 : 1) * 0.6,
            -0.5 + i * 1.5,
            (Math.random() - 0.5) * 0.8
        );
        glassIce.rotation.set(
            Math.random() * Math.PI,
            Math.random() * Math.PI,
            Math.random() * Math.PI
        );
        glassIce.castShadow = true;
        glassIce.receiveShadow = true;
        glassIce.userData = { 
            originalScale: size, 
            meltProgress: 0,
            originalY: -0.5 + i * 1.5
        };
        glassGroup.add(glassIce);
        glassIceCubes.push(glassIce);

        // Yeti ice
        const yetiIce = new THREE.Mesh(iceGeometry, iceMaterial.clone());
        yetiIce.position.set(
            (i === 0 ? -1 : 1) * 0.6,
            -0.5 + i * 1.5,
            (Math.random() - 0.5) * 0.8
        );
        yetiIce.rotation.set(
            Math.random() * Math.PI,
            Math.random() * Math.PI,
            Math.random() * Math.PI
        );
        yetiIce.castShadow = true;
        yetiIce.receiveShadow = true;
        yetiIce.userData = { 
            originalScale: size, 
            meltProgress: 0,
            originalY: -0.5 + i * 1.5
        };
        yetiGroup.add(yetiIce);
        yetiIceCubes.push(yetiIce);
    }
}

function updateIceMelting(deltaTime) {
    const minutes = simulationTime / 60;
    
    // Update glass ice cubes
    glassIceCubes.forEach(ice => {
        if (ice.userData.meltProgress < 1) {
            if (minutes > 5) {
                // Start actual melting after cooling period
                ice.userData.meltProgress = Math.min(1, ice.userData.meltProgress + GLASS_MELT_RATE * deltaTime);
            }
            
            // Ice starts at 85% of original size (equilibrium with cold water)
            // Then melts down to 5% before disappearing
            const baseScale = 0.85; // Starting size at equilibrium
            const meltScale = baseScale * (1 - ice.userData.meltProgress * 0.95);
            const scale = ice.userData.originalScale * meltScale;
            ice.scale.set(scale, scale, scale);
            ice.material.opacity = 0.8 * (1 - ice.userData.meltProgress * 0.6);
            
            if (ice.userData.meltProgress > 0.3) {
                ice.position.y -= 0.02 * deltaTime;
            }
        }
    });

    // Update yeti ice cubes
    yetiIceCubes.forEach(ice => {
        if (ice.userData.meltProgress < 1) {
            if (minutes > 8) {
                // Start actual melting after cooling period
                ice.userData.meltProgress = Math.min(1, ice.userData.meltProgress + YETI_MELT_RATE * deltaTime);
            }
            
            // Ice starts at 90% of original size (better insulation = less initial melting)
            const baseScale = 0.90;
            const meltScale = baseScale * (1 - ice.userData.meltProgress * 0.95);
            const scale = ice.userData.originalScale * meltScale;
            ice.scale.set(scale, scale, scale);
            ice.material.opacity = 0.8 * (1 - ice.userData.meltProgress * 0.6);
            
            if (ice.userData.meltProgress > 0.3) {
                ice.position.y -= 0.008 * deltaTime;
            }
        }
    });

    // Update temperatures
    updateTemperatures();
}

function updateTemperatures() {
    // Calculate average ice remaining
    let glassIceRemaining = 0;
    let yetiIceRemaining = 0;
    
    glassIceCubes.forEach(ice => {
        glassIceRemaining += (1 - ice.userData.meltProgress);
    });
    yetiIceCubes.forEach(ice => {
        yetiIceRemaining += (1 - ice.userData.meltProgress);
    });
    
    glassIceRemaining /= glassIceCubes.length;
    yetiIceRemaining /= yetiIceCubes.length;
    
    const minutes = simulationTime / 60;
    
    // Realistic temperature calculation: water cools gradually when ice is added
    let glassTemp, yetiTemp;
    
    // Glass temperature calculation
    if (minutes < 5) {
        // Initial cooling phase - water cools from room temp toward ice temp
        const coolingProgress = minutes / 5; // 5 minutes to reach equilibrium
        glassTemp = INITIAL_TEMP - (INITIAL_TEMP - ICE_TEMP) * coolingProgress * 0.8;
    } else if (glassIceRemaining > 0) {
        // Ice present - water stays cold but slightly above freezing
        glassTemp = ICE_TEMP + 2; // Water with ice stays around 34¬∞F
    } else {
        // No ice - glass warms up quickly due to poor insulation
        const timeSinceIceMelted = minutes - (1 / GLASS_MELT_RATE);
        if (timeSinceIceMelted > 0) {
            // Glass reaches room temp in 45-60 minutes after ice melts
            const warmupProgress = Math.min(1, timeSinceIceMelted / 50);
            glassTemp = ICE_TEMP + (INITIAL_TEMP - ICE_TEMP) * warmupProgress;
        } else {
            glassTemp = ICE_TEMP + 2;
        }
    }
    
    // Yeti temperature calculation
    if (minutes < 8) {
        // Initial cooling phase - Yeti cools slower due to insulation
        const coolingProgress = minutes / 8; // 8 minutes to reach equilibrium
        yetiTemp = INITIAL_TEMP - (INITIAL_TEMP - ICE_TEMP) * coolingProgress * 0.9;
    } else if (yetiIceRemaining > 0) {
        // Ice present - vacuum insulation keeps water very cold
        yetiTemp = ICE_TEMP + 1; // Water with ice stays around 33¬∞F
    } else {
        // No ice - Yeti warms up very slowly due to vacuum insulation
        const timeSinceIceMelted = minutes - (1 / YETI_MELT_RATE);
        if (timeSinceIceMelted > 0) {
            // Yeti takes 300-400 minutes to reach room temp after ice melts
            const warmupProgress = Math.min(1, timeSinceIceMelted / 350);
            yetiTemp = ICE_TEMP + (INITIAL_TEMP - ICE_TEMP) * warmupProgress;
        } else {
            yetiTemp = ICE_TEMP + 1;
        }
    }
    
    // Update display
    document.querySelector('#glass-temp .temp-value').textContent = formatTemperature(glassTemp);
    document.querySelector('#yeti-temp .temp-value').textContent = formatTemperature(yetiTemp);
}

function setupEventListeners() {
    // Play/Pause button
    document.getElementById('play-pause').addEventListener('click', () => {
        if (!isPlaying && simulationTime === 0) {
            // First time play - trigger ice drop
            startIceDropAnimation();
            setTimeout(() => {
                isPlaying = true;
                document.getElementById('play-pause').textContent = '‚è∏Ô∏è PAUSE';
            }, 1000);
        } else {
            isPlaying = !isPlaying;
            document.getElementById('play-pause').textContent = isPlaying ? '‚è∏Ô∏è PAUSE' : 'üé≥ ROLL';
        }
    });

    // Reset button
    document.getElementById('reset').addEventListener('click', () => {
        resetSimulation();
    });

    // Temperature toggle button
    document.getElementById('temp-toggle').addEventListener('click', () => {
        useCelsius = !useCelsius;
        document.getElementById('temp-toggle').textContent = useCelsius ? 'üå°Ô∏è ¬∞C' : 'üå°Ô∏è ¬∞F';
        updateTemperatures(); // Refresh display with new units
    });

    // Time slider
    const timeSlider = document.getElementById('time-slider');
    timeSlider.addEventListener('input', (e) => {
        simulationTime = parseFloat(e.target.value) * 60;
        updateSimulationToTime();
    });

    // Window resize
    window.addEventListener('resize', onWindowResize);
}

function resetSimulation() {
    isPlaying = false;
    simulationTime = 0;
    document.getElementById('play-pause').textContent = 'Play';
    document.getElementById('time-display').textContent = '‚è±Ô∏è Time: 0 min';
    document.getElementById('time-slider').value = 0;
    
    // Reset temperatures to same starting point
    document.querySelector('#glass-temp .temp-value').textContent = formatTemperature(INITIAL_TEMP);
    document.querySelector('#yeti-temp .temp-value').textContent = formatTemperature(INITIAL_TEMP);
    
    // Reset ice cubes to starting position (no drop animation)
    glassIceCubes.forEach(ice => {
        ice.userData.meltProgress = 0;
        // Start at 85% size (equilibrium with cold water)
        const scale = ice.userData.originalScale * 0.85;
        ice.scale.set(scale, scale, scale);
        ice.material.opacity = 0.8;
        ice.position.y = ice.userData.originalY;
    });
    
    yetiIceCubes.forEach(ice => {
        ice.userData.meltProgress = 0;
        // Start at 90% size (better insulation = less initial melting)
        const scale = ice.userData.originalScale * 0.90;
        ice.scale.set(scale, scale, scale);
        ice.material.opacity = 0.8;
        ice.position.y = ice.userData.originalY;
    });
}

function startIceDropAnimation() {
    // Animate ice cubes dropping from above
    glassIceCubes.forEach((ice, index) => {
        ice.position.y = 8; // Start high above
        // Set to starting equilibrium size
        const scale = ice.userData.originalScale * 0.85;
        ice.scale.set(scale, scale, scale);
        
        // Animate drop with slight delay
        setTimeout(() => {
            animateIceDrop(ice, ice.userData.originalY);
        }, index * 200);
    });
    
    yetiIceCubes.forEach((ice, index) => {
        ice.position.y = 8; // Start high above
        // Set to starting equilibrium size
        const scale = ice.userData.originalScale * 0.90;
        ice.scale.set(scale, scale, scale);
        
        // Animate drop with slight delay
        setTimeout(() => {
            animateIceDrop(ice, ice.userData.originalY);
        }, index * 200);
    });
}

function animateIceDrop(ice, targetY) {
    const dropSpeed = 0.15;
    const gravity = 0.01;
    let velocity = 0;
    
    function drop() {
        velocity += gravity;
        ice.position.y -= velocity;
        
        if (ice.position.y <= targetY) {
            ice.position.y = targetY;
            // Small bounce effect
            ice.position.y += Math.sin(Date.now() * 0.01) * 0.05;
            return;
        }
        
        requestAnimationFrame(drop);
    }
    
    drop();
}

function updateSimulationToTime() {
    // Calculate melting progress based on time
    const minutes = simulationTime / 60;
    
    glassIceCubes.forEach(ice => {
        if (minutes > 5) {
            ice.userData.meltProgress = Math.min(1, (minutes - 5) * GLASS_MELT_RATE);
        } else {
            ice.userData.meltProgress = 0;
        }
        
        // Use same scaling logic as updateIceMelting
        const baseScale = 0.85;
        const meltScale = baseScale * (1 - ice.userData.meltProgress * 0.95);
        const scale = ice.userData.originalScale * meltScale;
        ice.scale.set(scale, scale, scale);
        ice.material.opacity = 0.8 * (1 - ice.userData.meltProgress * 0.6);
        ice.position.y = ice.userData.originalY - (ice.userData.meltProgress > 0.3 ? (ice.userData.meltProgress - 0.3) * 2 : 0);
    });
    
    yetiIceCubes.forEach(ice => {
        if (minutes > 8) {
            ice.userData.meltProgress = Math.min(1, (minutes - 8) * YETI_MELT_RATE);
        } else {
            ice.userData.meltProgress = 0;
        }
        
        // Use same scaling logic as updateIceMelting
        const baseScale = 0.90;
        const meltScale = baseScale * (1 - ice.userData.meltProgress * 0.95);
        const scale = ice.userData.originalScale * meltScale;
        ice.scale.set(scale, scale, scale);
        ice.material.opacity = 0.8 * (1 - ice.userData.meltProgress * 0.6);
        ice.position.y = ice.userData.originalY - (ice.userData.meltProgress > 0.3 ? (ice.userData.meltProgress - 0.3) * 1 : 0);
    });
    
    updateTemperatures();
    document.getElementById('time-display').textContent = `‚è±Ô∏è Time: ${Math.round(minutes)} min`;
}

function onWindowResize() {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
}

let lastTime = 0;
function animate(currentTime) {
    requestAnimationFrame(animate);
    
    const deltaTime = (currentTime - lastTime) / 1000;
    lastTime = currentTime;
    
    if (isPlaying && deltaTime < 0.1) {
        simulationTime += deltaTime * 60;
        updateIceMelting(deltaTime);
        
        const minutes = Math.floor(simulationTime / 60);
        document.getElementById('time-display').textContent = `‚è±Ô∏è Time: ${minutes} min`;
        document.getElementById('time-slider').value = minutes;
    }
    
    // Gentle rotation for visual interest
    glassGroup.rotation.y += 0.001;
    yetiGroup.rotation.y += 0.001;
    
    // Rotate ice cubes slowly
    glassIceCubes.forEach(ice => {
        ice.rotation.y += 0.002;
        ice.rotation.x += 0.001;
    });
    
    yetiIceCubes.forEach(ice => {
        ice.rotation.y += 0.002;
        ice.rotation.x += 0.001;
    });
    
    renderer.render(scene, camera);
}

// Initialize the scene when page loads
window.addEventListener('load', () => {
    try {
        init();
    } catch (error) {
        console.error('Error initializing scene:', error);
        document.getElementById('container').innerHTML = '<div style="color: white; padding: 20px; text-align: center;">Error loading 3D scene: ' + error.message + '</div>';
    }
});
    </script>
</body>
</html>